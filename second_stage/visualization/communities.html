<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="./jquery-ui-1.11.4/jquery-ui.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div id="container" class="container centered">
        <div class="row">
            <div class="span4 collapse-group">
        <h1>Example of community detection for "corrupcion+penta+udi"</h1>

        <p>This was built using a minimum of 2 data points, a minimum
        correlation of 0.231 and no restrictions on the sensitivity to singular
        events.</p>
        </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./jquery-ui-1.11.4/jquery-ui.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <style>
    .vcenter {
        display: inline-block;
        vertical-align: middle;
        float: none;
    }
    
    .node {
      stroke: #000000;
      stroke-width: 0.5px;
    }

    .link {
    }

    </style>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>

      $(function() {
        
        d3.json("communities.json", function(error, graph) {
       
          var width = 1000,
              height = 600;
          
          var svg = d3.select("#container").append("svg")
              .attr("width", width)
              .attr("height", height)
              .attr("class", "text-center");
          
          var graph_data;
          var color = d3.scale.category20();
        
          var linkcolorpos = d3.scale.linear()
          .domain([0,1])
          .range(["gray", "red"]);
        
          var linkcolorneg = d3.scale.linear()
          .domain([-1, 0])
          .range(["blue", "gray"]);
        
          var links = []
          var min_s = Infinity;
          var max_s = -Infinity;
        
          var min_n = Infinity;
          var max_n = -Infinity;
          
          for (var i = 0; i < graph.links.length; i++) {
            var link = graph.links[i];
   
            if (link.value[2] >= graph.min_n &&
                link.value[1] < graph.max_sens && 
                link.value[1] >= graph.min_sens && 
                link.value[0] > graph.min_corr) {
                links[links.length] = link;
                if (link.value[1] < min_s) {
                    min_s = link.value[1];
                }
        
                if (link.value[1] > max_s) {
                    max_s = link.value[1];
                }
                    
                if (link.value[2] < min_n) {
                    min_n = link.value[2];
                }
        
                if (link.value[2] > max_n) {
                    max_n = link.value[2];
                }
        
            }
          }
       
          var linkwidth = d3.scale.linear()
              .domain([graph.min_n - 1, max_n])
              .range([2, 5]).clamp(true);
        
          var force = d3.layout.force()
              .charge(-150)
              .linkDistance(60)
              .size([width, height]);
                
          var min_size = Infinity;
          var max_size = -Infinity;

          for (var i = 0; i < graph.nodes.length; i++) {
              var node = graph.nodes[i];
              if (node.size < min_size) {
                  min_size = node.size;
              }

              if (node.size > max_size) {
                  max_size = node.size;
              }
          }
          
          var size = d3.scale.log()
                    .domain([min_size, max_size])
                    .range([5, 20]);
          force
              .nodes(graph.nodes)
              .links(links)
              .start();
        
          var link = svg.selectAll(".link")
              .data(links)
            .enter().append("line")
              .attr("class", "link")
              .style("stroke", function(d) { return (d.value[0] > 0)?
                  linkcolorpos(d.value[0]):linkcolorneg(d.value[0])} )
              .style("stroke-width", function(d) { 
                  return linkwidth(d.value[2]);} );
        
          link.append("title")
            .text(function(d) { return "Correlation: " + d.value[0] + 
                "\nConfidence Interval (95%): " + d.value[1] + 
                "\nNumber of data points: " + d.value[2]; });
            
          var node = svg.selectAll(".node")
              .data(graph.nodes)
            .enter().append("circle")
              .attr("class", "node")
              .attr("r", function(d) { return size(d.size); })
              .style("fill", function(d) { return color(d.color_value); })
              .call(force.drag);
        
          node.append("title")
              .text(function(d) { return d.name; });
        
          force.on("tick", function() {
            link.attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });
        
            node.attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });
          });
        });


      });
    </script>

</body>
</html>
